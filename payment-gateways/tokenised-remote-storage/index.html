<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tokenised Remote Storage - WHMCS Developer Documentation</title>
    <meta name="generator" content="Hugo 0.17" />

    
    <meta name="description" content="WHMCS developer documentation - themes, modules, hooks, oauth, api and more...">
    
    <link rel="canonical" href="//developers.whmcs.com/payment-gateways/tokenised-remote-storage/">
    
    <meta name="author" content="WHMCS Development Team">
    

    <link rel="stylesheet" href="//developers.whmcs.com/css/bootstrap.min.css">
    <link rel="stylesheet" href="//developers.whmcs.com/css/styles.css?v=3">
    <link rel="stylesheet" href="//developers.whmcs.com/css/font-awesome.min.css">
    <link rel="stylesheet" href="//developers.whmcs.com/css/prism.css">

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:400,700">

    

  </head>
  <body class="language-php">

<header class="header">





<div class="container">
<nav class="navbar navbar-whmcs">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#primary-nav" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.whmcs.com/"><img src="//developers.whmcs.com/img/logo.png" width="148" height="34"></a>
    </div>

    <div class="collapse navbar-collapse" id="primary-nav">
      <ul class="nav navbar-nav">
        <li><a href="//developers.whmcs.com/"><span class="hidden-sm">Developer Documentation</span><span class="visible-sm">Developer Docs</span></a></li>
        <li class="visible-xs"><a href="//developers.whmcs.com/">Home</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/themes/">Themes</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/languages/">Languages</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/modules/">Modules</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/oauth/">OAuth</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/hooks/">Hooks</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/api/">API</a></li>
            <li class="visible-xs"><a href="//developers.whmcs.com/advanced/">Advanced</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="//developers.whmcs.com/api-reference/">API Reference</a></li>
        <li><a href="//developers.whmcs.com/hooks-reference/">Hook Reference</a></li>
        <li><a href="https://github.com/whmcs" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
      <form class="navbar-form navbar-right visible-xs" id="docsSearchMobile">
        <div class="aa-input-container" id="aa-input-container">
            <input type="search" id="inputSearchMobile" class="aa-input-search" placeholder="Search documentation" name="search" autocomplete="off" />
            <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
                <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
            </svg>
        </div>
      </form>
    </div>
  </div>
</nav>
</div>

<div class="headline-bar hidden-xs">
<nav class="navbar navbar-main-nav">
  <div class="container">
    <div class="collapse navbar-collapse" id="secondary-nav">
      <ul class="nav navbar-nav">
        <li><a href="//developers.whmcs.com/">Home</a></li>
            <li><a href="//developers.whmcs.com/themes/">Themes</a></li>
            <li><a href="//developers.whmcs.com/languages/">Languages</a></li>
            <li><a href="//developers.whmcs.com/modules/">Modules</a></li>
            <li><a href="//developers.whmcs.com/oauth/">OAuth</a></li>
            <li><a href="//developers.whmcs.com/hooks/">Hooks</a></li>
            <li><a href="//developers.whmcs.com/api/">API</a></li>
            <li><a href="//developers.whmcs.com/advanced/">Advanced</a></li>
      </ul>
      <form class="navbar-form navbar-right" id="docsSearch">
        <div class="aa-input-container" id="aa-input-container">
            <input type="search" id="inputSearch" class="aa-input-search" placeholder="Search documentation" name="search" autocomplete="off" />
            <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
                <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
            </svg>
        </div>
      </form>
    </div>
  </div>
</nav>
</div>

</header>


<main class="main">

  <div class="container">
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-sm-3 sidebar-offcanvas">

        
          <ul class="sidebar-nav">
            
  <li class="active parent" data-nav-id="/payment-gateways/">
    <a href="//developers.whmcs.com/payment-gateways/">
      <span>
        
          <i class='fa fa-money fa-fw'></i>
        
         Payment Gateways
       </span>
    </a>
    
    <ul>
      
      
      
      
        <li class="" data-nav-id="/payment-gateways/getting-started/">
          <a href="//developers.whmcs.com/payment-gateways/getting-started/">
            <span>Getting Started</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/meta-data-params/">
          <a href="//developers.whmcs.com/payment-gateways/meta-data-params/">
            <span>Meta Data Parameters</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/configuration/">
          <a href="//developers.whmcs.com/payment-gateways/configuration/">
            <span>Configuration</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/third-party-gateway/">
          <a href="//developers.whmcs.com/payment-gateways/third-party-gateway/">
            <span>Third Party Gateway</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/subscription-management/">
          <a href="//developers.whmcs.com/payment-gateways/subscription-management/">
            <span>Subscription Management</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/merchant-gateway/">
          <a href="//developers.whmcs.com/payment-gateways/merchant-gateway/">
            <span>Merchant Gateway</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/displaying-balances/">
          <a href="//developers.whmcs.com/payment-gateways/displaying-balances/">
            <span>Displaying Balances</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/transaction-information/">
          <a href="//developers.whmcs.com/payment-gateways/transaction-information/">
            <span>Transaction Information</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/callbacks/">
          <a href="//developers.whmcs.com/payment-gateways/callbacks/">
            <span>Callback Files</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/refunds/">
          <a href="//developers.whmcs.com/payment-gateways/refunds/">
            <span>Refunds</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/reversals/">
          <a href="//developers.whmcs.com/payment-gateways/reversals/">
            <span>Payment Reversals</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/3d-secure/">
          <a href="//developers.whmcs.com/payment-gateways/3d-secure/">
            <span>3D Secure Process</span>
          </a>
        </li>
      
      
      
        <li class="active" data-nav-id="/payment-gateways/tokenised-remote-storage/">
          <a href="//developers.whmcs.com/payment-gateways/tokenised-remote-storage/">
            <span>Tokenised Remote Storage</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/remote-input-gateway/">
          <a href="//developers.whmcs.com/payment-gateways/remote-input-gateway/">
            <span>Remote Input Token Storage</span>
          </a>
        </li>
      
      
      
        <li class="" data-nav-id="/payment-gateways/installation-activation/">
          <a href="//developers.whmcs.com/payment-gateways/installation-activation/">
            <span>Installation &amp; Activation</span>
          </a>
        </li>
      
      
    </ul>
    
  </li>


          </ul>
        

      </div>
      <div class="col-sm-9">

        <div class="breadcrumb-nav">

            <div class="pull-right">
              <a class="suggest-an-edit" href="https://github.com/WHMCS/developer-docs" target="blank">
                <i class="fa fa-code-fork"></i>
                <span class="hidden-xs">Suggest an edit</span>
              </a>
            </div>

            <div class="visible-xs pull-left">
                <button type="button" class="btn btn-toggle-sidebar" data-toggle="offcanvas">
                    <i class="fa fa-list-alt"></i>
                </button>
            </div>

            <div id="breadcrumbs">
                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="//developers.whmcs.com/payment-gateways/" itemprop="url"><span itemprop="title">Payment Gateways</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                  
                
                <span itemprop="title"> Tokenised Remote Storage</span>
              </div>
            </div>


			<h1>Tokenised Remote Storage </h1>

			

<p>Tokenisation is the replacement of sensitive payment information with a unique identifier (a token).</p>

<p>Therefore in WHMCS, a tokenised payment gateway module is one where the sensitive payment data is stored remotely by the payment gateway. This reduces the risk of data breaches because it means that unauthorized access to the local system does not risk exposing customer&rsquo;s sensitive payment information.</p>

<h2 id="creating-a-token-gateway">Creating a Token Gateway</h2>

<p>Payment gateways can operate tokenisation platforms in a variety of ways.</p>

<h3 id="capture-token-exchange">Capture Token Exchange</h3>

<p>At its simplest, a payment gateway may exchange or return a token for you to use for future charges following a regular capture being performed.</p>

<p>For payment gateways that function in this way, you should return the token along with the result from the capture function. WHMCS will then automatically purge the locally stored payment details and replace them with the token.</p>

<p>The following return parameters are supported.</p>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>status</td>
<td>string</td>
<td>One of either <code>success</code>, <code>pending</code>, <code>declined</code></td>
</tr>

<tr>
<td>declinereason</td>
<td>string</td>
<td>The reason for a decline</td>
</tr>

<tr>
<td>transid</td>
<td>string</td>
<td>The Transaction ID returned by the payment gateway</td>
</tr>

<tr>
<td>fee</td>
<td>float</td>
<td>The transaction fee returned by the payment gateway</td>
</tr>

<tr>
<td>rawdata</td>
<td>string or array</td>
<td>The raw data returned by the payment gateway for logging to the gateway log to aid in debugging</td>
</tr>

<tr>
<td>gatewayid</td>
<td>string</td>
<td>The token returned by the payment gateway</td>
</tr>
</tbody>
</table>

<h4 id="example">Example</h4>

<pre><code>function yourmodulename_capture($params) {
    $gatewayid = $params['gatewayid'];
    $cardnum = $params['cardnum'];
    
    if ($gatewayid) {
        // Make API call to perform capture using the token here
        // Dummy response assumed below in $response variable.        

        return [
            'status' =&gt; 'success',
            'transid' =&gt; $response['transaction_id']
            // Return a value in gatewayid to update the token only if required
            'gatewayid' =&gt; $response['token'],
            'rawdata' =&gt; $response,
        ];
    } else {
        // Make API call to perform capture using the card number here
        // Dummy response assumed below in $response variable.
        $response = [];

        return [
            'status' =&gt; 'success',
            'transid' =&gt; $response['transaction_id']
            'gatewayid' =&gt; $response['token'],
            'rawdata' =&gt; $response,
        ];
    }
}
</code></pre>

<h3 id="remote-storage">Remote Storage</h3>

<p>For payment gateways where tokens have to be created and managed separately from capture attempts, you should use the remote storage method within your WHMCS gateway module.</p>

<p>This function will override the default behaviour when entering new, updating an existing, or deleting credit card details.</p>

<p>The following parameters are passed into the <code>storeremote</code> function.</p>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>action</td>
<td>string</td>
<td>One of either <code>create</code>, <code>update</code>, or <code>delete</code></td>
</tr>

<tr>
<td>gatewayid</td>
<td>string</td>
<td>The token for the pay method to be updated</td>
</tr>

<tr>
<td>cardtype</td>
<td>string</td>
<td>The card type (Visa, MasterCard, etc..)</td>
</tr>

<tr>
<td>cardnum</td>
<td>string</td>
<td>The card number</td>
</tr>

<tr>
<td>cardexp</td>
<td>int</td>
<td>The card expiry date (Format: MMYY)</td>
</tr>

<tr>
<td>cardstart</td>
<td>int</td>
<td>The card start date (Format: MMYY)</td>
</tr>

<tr>
<td>cardissuenum</td>
<td>int</td>
<td>The card issue number</td>
</tr>
</tbody>
</table>

<p>The following return parameters are supported.</p>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>status</td>
<td>string</td>
<td>One of either <code>success</code> or <code>error</code></td>
</tr>

<tr>
<td>rawdata</td>
<td>string or array</td>
<td>The raw data returned by the payment gateway for logging to the gateway log to aid in debugging</td>
</tr>

<tr>
<td>gatewayid</td>
<td>string</td>
<td>The token returned by the payment gateway</td>
</tr>
</tbody>
</table>

<h4 id="example-1">Example</h4>

<pre><code>function yourmodulename_storeremote($params) {
    $action = $params['action'];
    $gatewayid = $params['gatewayid'];
    $cardtype = $params['cardtype'];
    $cardnum = $params['cardnum'];
    $cardexp = $params['cardexp'];
    $cardstart = $params['cardstart'];
    $cardissuenum = $params['cardissuenum'];

    switch ($action) {
        case 'create':
            // Make API call to create a token here
            $postfields = [
                'cardnumber' =&gt; $cardnum,
                'cardexpiry' =&gt; $cardexp,
                'cardcvv' =&gt; $params['cccvv'],
            ];
        
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'https://www.example.com/api/store');
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($postfields));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            $response = curl_exec($ch);
            curl_close($ch);
        
            $data = json_decode($response);

            return [
                'status' =&gt; 'success',
                'gatewayid' =&gt; $data-&gt;remote_id,
            ];
            break;
        case 'update':
            // Make API call to update a token here
            $postfields = [
                'remote_id' =&gt; $gatewayid,
                'cardexpiry' =&gt; $cardexp,
            ];
        
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'https://www.example.com/api/update');
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($postfields));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            $response = curl_exec($ch);
            curl_close($ch);
        
            $data = json_decode($response);
            return [
                'status' =&gt; 'success',
                'gatewayid' =&gt; $data-&gt;remote_id,
            ];
            break;
        case 'delete':
            // Make API call to delete a token here
            $postfields = [
                'remote_id' =&gt; $gatewayid,
            ];
        
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, 'https://www.example.com/api/delete');
            curl_setopt($ch, CURLOPT_POST, 1);
            curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($postfields));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            $response = curl_exec($ch);
            curl_close($ch);
        
            $data = json_decode($response);
            return [
                'status' =&gt; 'success',
            ];
            break;
    }
}
</code></pre>


			<div class="topic-navigation clearfix">
                
                    <a class="nav nav-prev" href="//developers.whmcs.com/payment-gateways/3d-secure">
                        <i class="fa fa-arrow-circle-left"></i>
                        Previous
                    </a>
                
                
                    <a class="nav nav-next" href="//developers.whmcs.com/payment-gateways/installation-activation">
                        <i class="fa fa-arrow-circle-right"></i>
                        Next
                    </a>
                
            </div>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>

        </div>
  </div>
</div>
</main>


<footer class="footer">
    <div class="container">
        <div class="row">
            <nav>
                <div class="col-sm-3">
                    <h3>Learn</h3>
                    <ul>
                        <li><a href="//developers.whmcs.com/about/">About WHMCS</a></li>
                        <li><a href="//developers.whmcs.com/about/quick-start/">Quick start</a></li>
                        <li><a href="//developers.whmcs.com/api-reference/">API Reference</a></li>
                        <li><a href="https://docs.whmcs.com/classes/">Classes Reference</a></li>
                        <li><a href="//developers.whmcs.com/about/faq/">FAQ</a></li>
                    </ul>
                </div>
                <div class="col-sm-4">
                    <h3>Contribute</h3>
                    <ul>
                        <li><a href="//developers.whmcs.com/about/contribute/">Contribute</a></li>
                        <li><a href="https://github.com/whmcs/" target="_blank">Github</a></li>
                    </ul>
                </div>
                <div class="col-sm-5">
                    <h3>Stay up to date</h3>
                    <div class="subscribe-form">
                        <p class="muted subscribe-lead">Join our developers mailing list to be kept up-to-date.</p>
                        <div class="alert alert-success sub-success-message hidden" role="alert">
                            <strong>Thank You!</strong> You have been subscribed.
                        </div>
                        <div class="alert alert-danger sub-error-message hidden" role="alert">
                            <strong>Sorry</strong> <span id="error-message-text"></span>
                        </div>
                        <form action="//www.whmcs.com/members/subscribe.php" method="post" id="frmSubscribe">
                            <input type="hidden" name="name" value="Subscriber">
                            <input type="hidden" name="developer" value="dev">
                            <div class="input-group">
                                <input type="email" name="email" class="form-control" placeholder="you@yourdomain.com">
                                <span class="input-group-btn">
                                    <button type="submit" class="btn btn-info">
                                        SUBSCRIBE
                                    </button>
                                </span>
                            </div>
                        </form>
                    </div>
                    <p>
                        We won't spam you.
                    </p>
                </div>
            </nav>
        </div>
        <div class="row">
            <div class="col-md-7">
                <p>Found an error or a typo in these docs? <a href="https://github.com/WHMCS/developer-docs/issues">Submit an issue or a pull request</a></p>
            </div>
            <div class="col-md-5">
                <p class="pull-right">
                    Copyright &copy; WHMCS 2021. All rights reserved.
                    <br>
                </p>
            </div>
        </div>
    </div>
</footer>

<script src="//developers.whmcs.com/js/jquery.min.js"></script>
<script src="//developers.whmcs.com/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
<script src="//developers.whmcs.com/js/search.js?v=2"></script>
<script src="//developers.whmcs.com/js/prism.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22019969-15', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>

